{"version":3,"sources":["webpack://mobiusforms/webpack/bootstrap","webpack://mobiusforms/./src/ts/add-ins/recaptcha.ts","webpack://mobiusforms/./src/ts/add-ins/uiActions.ts","webpack://mobiusforms/./src/ts/collect-fields/auto.ts","webpack://mobiusforms/./src/ts/collect-fields/manual.ts","webpack://mobiusforms/./src/ts/main.ts"],"names":["enumerable","get","getter","value","key","bind","module","Object","prototype","hasOwnProperty","call","object","property","helperFunc","UiActions","c","recapId","clsRecap","clsRecapWrap","init","wrapper","recap","find","this","isNaN","data","id","grecaptcha","render","check","length","getResponse","Recaptcha","showOneAlert","showId","hide","show","disableInputs","state","toggleClass","prop","attachFieldValidateOnBlur","$","smkValidate","collect","Files","promises","not","map","i","field","element","propName","attr","toLowerCase","Deferred","files","FileReader","addEventListener","push","Encoded","result","Name","name","Field","resolve","readAsDataURL","promise","is","val","add","when","apply","then","CollectFieldsAutomatic","Subject","Message","SenderName","SenderMail","CollectFieldsManual","moduleId","collectFieldsManual","collectFieldsAutomatic","recaptcha","alreadyInit","clsWrp","clsForm","moduleWrapper","initialize","on","each","item","evt","send","event","btn","currentTarget","sxc","$2sxc","label","text","trackingEvent","CustomEvent","detail","category","action","document","dispatchEvent","mailchimp","hasClass","ws","MailChimp","webApi","post","success","msg","error","App"],"mappings":"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","file":"app-bundle.min.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n","declare let grecaptcha: any;\r\n\r\nimport { UiActions } from './uiActions';\r\n\r\nexport class Recaptcha {\r\n  helperFunc = new UiActions();\r\n\r\n  c  = {\r\n    recapId: \"recapId\",\r\n    clsRecap: \"app-jqfs-recaptcha\",\r\n    clsRecapWrap: \"app-recaptcha-wrapper\"\r\n  };\r\n\r\n  constructor() { }\r\n\r\n  /*\r\n    Initialize Recaptcha and create a Recapcha Checkbox below the Formfields \r\n  */\r\n  init(wrapper: JQuery) {\r\n    const recap = wrapper.find(this.c.clsRecap);\r\n\r\n    if(!isNaN(wrapper.data(this.c.recapId))) {\r\n        return;\r\n    }\r\n\r\n    const id = grecaptcha.render(recap, {\r\n      'sitekey' : recap.data(\"sitekey\"),\r\n      'size' : 'normal'\r\n    });\r\n\r\n    wrapper.data(this.c.recapId, id); // remember for later use       \r\n  }\r\n\r\n\r\n  \r\n  /* \r\n    Checks if a recaptcha is implemented in the current Form\r\n  */\r\n  check(wrapper: JQuery) {\r\n    const recap = wrapper.find(\".\" + this.c.clsRecap);\r\n    // if no recaptcha found, probably ok\r\n    if(recap.length === 0) {\r\n      return true;\r\n    }\r\n\r\n    // if many found, probably not ok\r\n    if(recap.length !== 1) {\r\n      throw \"recaptcha not found\";\r\n    }\r\n\r\n    // return google response for the recap\r\n    const res = grecaptcha.getResponse(); // null if failed, something cryptic if ok\r\n\r\n    return res || false; \r\n  }\r\n}","// rename to UiActions\r\nexport class UiActions {\r\n  showOneAlert(wrapper: JQuery, showId: string) {\r\n    wrapper.find('.alert').hide();\r\n    if (showId !== '') {\r\n      wrapper.find('#' + showId).show();\r\n    }\r\n  }\r\n\r\n  disableInputs(wrapper: JQuery, state: boolean) {\r\n    wrapper.toggleClass('disable', state)\r\n    wrapper.find(':input').prop('disabled', state);\r\n  }\r\n\r\n  attachFieldValidateOnBlur() {\r\n    // skif if validation is already enabled\r\n    if ($(this).data('alreadyRun')) return;\r\n\r\n    // not yet enabled, let's enable and remember...\r\n    ($(this) as any).smkValidate();\r\n    $(this).data('alreadyRun', true);\r\n  }\r\n}","export class CollectFieldsAutomatic {\r\n  // automatically build the send-object with all properties, \r\n  // based on all form-fields which have a item-property=\"\"\r\n  collect(wrapper: JQuery) {\r\n    let data: any = {\r\n      Files: []\r\n    };\r\n    const fields = wrapper.find(':input').not('button');\r\n    const promises = fields.map((i, field) => add(i, field));\r\n    \r\n    function add(i: number, element: any) {\r\n      element = $(element);\r\n      // get the property name from special-attribut, name OR id\r\n      const propName = element.attr('name') || element.attr('id');\r\n\r\n      if (!propName)\r\n        return;\r\n\r\n      // extract data from file fields\r\n      if (element.attr('type') && element.attr('type').toLowerCase() == 'file') {\r\n        const deferred = $.Deferred();\r\n        const file = element.get(0).files[0];\r\n        if (!file)\r\n          return;\r\n\r\n        const reader = new FileReader();\r\n\r\n        reader.addEventListener('load', function () {\r\n          data.Files.push({\r\n            Encoded: reader.result,\r\n            Name: file.name,\r\n            Field: propName\r\n          });\r\n          deferred.resolve();\r\n        }, false);\r\n        reader.readAsDataURL(file);\r\n\r\n        return deferred.promise();\r\n\r\n      } else if (element.attr('type') && element.attr('type').toLowerCase() == 'radio') { // For radio fields get checked values\r\n        if (element.is(':checked')) {\r\n          data[propName] = element.val();\r\n        }\r\n      } else { // For all standard fields, set value directly\r\n        data[propName] = element.val();\r\n      }\r\n    }\r\n\r\n    return $.when.apply($, promises).then(() => {\r\n      return data;\r\n    });\r\n  }\r\n}","/*\r\n  This is an example of collecting the fields manually (instead of automatically). \r\n  You would modify this file list all the fields you want, which allows you to use\r\n  a different naming schema than the default. \r\n  This is an advanced use case, and included so you could do this, but you usually won't want to.\r\n*/\r\nexport class CollectFieldsManual {\r\n  // automatically build the send-object with all properties, \r\n  // based on all form-fields which have a item-property=\"\"\r\n  collect(wrapper: JQuery) {\r\n    const data: any = {\r\n      Subject: wrapper.find('#Subject'),\r\n      Message: wrapper.find('#Message'),\r\n      SenderName: wrapper.find('#Sendername'),\r\n      SenderMail: wrapper.find('#Sendermail')\r\n    };\r\n\r\n    for (let prop in data) {\r\n      if (data.hasOwnProperty(prop)) {\r\n        data[prop] = data[prop].val();\r\n      }\r\n    }\r\n\r\n    return data;\r\n  }\r\n}","declare let $2sxc: any;\r\n\r\nimport { UiActions } from './add-ins/uiActions';\r\nimport { CollectFieldsManual } from './collect-fields/manual';\r\nimport { CollectFieldsAutomatic } from './collect-fields/auto';\r\nimport { Recaptcha } from './add-ins/recaptcha';\r\nexport class App {\r\n  helperFunc = new UiActions();\r\n  collectFieldsManual = new CollectFieldsManual();\r\n  collectFieldsAutomatic = new CollectFieldsAutomatic();\r\n  recaptcha = new Recaptcha();\r\n  moduleWrapper: JQuery;\r\n  alreadyInit = false;\r\n\r\n  c = {\r\n    clsWrp: 'app-jqfs-wrapper',\r\n    clsForm: 'app-jqfs-form',\r\n  };\r\n\r\n  constructor(\r\n    moduleId: number,\r\n  ) {\r\n    // disable validate on the global asp.net form, to not interfere with the contact-form\r\n    $('form').attr('novalidate', '');\r\n    this.moduleWrapper = $(`.DnnModule-${moduleId}`);\r\n  }\r\n\r\n  public initialize() {\r\n    const wrapper = this.moduleWrapper;\r\n    // attach validation to enable as soon as we blur        \r\n    wrapper.on('blur', ':input', this.helperFunc.attachFieldValidateOnBlur);\r\n\r\n    wrapper.each((i, item) => {\r\n      // prevent dupl execution\r\n      if (this.alreadyInit)\r\n        return;\r\n\r\n      const wrap = $(item);\r\n      wrap.find('#sendFormWithApi').on('click', (evt: JQueryEventObject) => this.send(evt)); // handle click event\r\n\r\n      this.alreadyInit = true;\r\n    });\r\n  }\r\n\r\n  public send(event: JQueryEventObject) {\r\n    const btn = event.currentTarget;\r\n    const sxc = $2sxc(btn);\r\n    const wrapper = this.moduleWrapper;\r\n    const label = wrapper.find('#sendFormWithApi').text();\r\n\r\n    // clear all alerts\r\n    this.helperFunc.showOneAlert(wrapper, '');\r\n\r\n    const trackingEvent = new CustomEvent('trackMobiusForm', { detail: { category: 'mobius-form', action: 'submit', label: label } });\r\n    document.dispatchEvent(trackingEvent);\r\n\r\n    // Validate form\r\n    if (!(wrapper as any).smkValidate())\r\n      return this.helperFunc.showOneAlert(wrapper, 'msgIncomplete');\r\n\r\n    // Do Recaptcha test, show alert & fail if required and not complete\r\n    const recap = this.recaptcha.check(wrapper);\r\n    if (!recap)\r\n      return this.helperFunc.showOneAlert(wrapper, 'msgRecap');\r\n\r\n    const mailchimp = wrapper.find('.app-jqfs-wrapper').hasClass('app-jqfs-mailchimp-wrapper');\r\n\r\n    // get data \r\n    // alternative example with manual build, but we prefer automatic\r\n    // let data;\r\n    // data = this.collectFieldsManual.collect(wrapper);\r\n    this.collectFieldsAutomatic.collect(wrapper).then((data: any) => {\r\n      const ws = wrapper.find('.app-jqfs-wrapper').data('webservice'); // should be \"Form/ProcessForm\" or a custom override\r\n      data.Recaptcha = recap;\r\n      data.MailChimp = mailchimp;\r\n\r\n      // submission\r\n      this.helperFunc.disableInputs(wrapper, true);\r\n      this.helperFunc.showOneAlert(wrapper, 'msgSending'); // show \"sending...\"\r\n\r\n      sxc.webApi.post(ws, {}, data, true)\r\n        .success(() => {\r\n          const msg = mailchimp ? 'msgNewsletterSuccess' : 'msgOk';\r\n          this.helperFunc.showOneAlert(wrapper, msg);\r\n\r\n          const trackingEvent = new CustomEvent('trackMobiusForm', { detail: { category: 'mobius-form', action: 'success', label: label } });\r\n          document.dispatchEvent(trackingEvent);\r\n        })\r\n        .error(() => {\r\n          const msg = mailchimp ? 'msgNewsletterFailed' : 'msgError';\r\n          this.helperFunc.showOneAlert(wrapper, msg);\r\n          this.helperFunc.disableInputs(wrapper, false);\r\n\r\n          const trackingEvent = new CustomEvent('trackMobiusForm', { detail: { category: 'mobius-form', action: 'error', label: label } });\r\n          document.dispatchEvent(trackingEvent);\r\n        });\r\n    });\r\n  }\r\n}"],"sourceRoot":""}